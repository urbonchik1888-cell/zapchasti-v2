<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ç–∞–ª–æ–≥ –∑–∞–ø—á–∞—Å—Ç–µ–π</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>üîß –ö–∞—Ç–∞–ª–æ–≥ –∑–∞–ø—á–∞—Å—Ç–µ–π</h1>
        <div class="header-controls">
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –∑–∞–ø—á–∞—Å—Ç–µ–π..." class="search-input">
            </div>
            <div class="auth-controls">
                <button id="loginBtn" class="auth-btn">–í–æ–π—Ç–∏</button>
                <button id="registerBtn" class="auth-btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                <button id="addPartBtn" class="add-btn" style="display: none;">+ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—á–∞—Å—Ç—å</button>
                <button id="syncBtn" class="sync-btn" onclick="syncData()" title="–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ">üîÑ</button>
                <button id="testSaveBtn" class="sync-btn" onclick="testGitHubSave()" title="–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ GitHub">üíæ</button>
                <button id="diagnoseBtn" class="sync-btn" onclick="diagnoseGitHub()" title="–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ GitHub">üîç</button>
                <div id="userInfo" style="display: none;">
                    <span id="userName"></span>
                    <button id="profileBtn" class="auth-btn">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</button>
                    <button id="logoutBtn" class="auth-btn">–í—ã–π—Ç–∏</button>
                </div>
            </div>
        </div>
    </header>

    <nav class="categories">
        <div class="category-dropdown">
            <button class="category-btn active dropdown-toggle" data-category="all">
                –í—Å–µ –∑–∞–ø—á–∞—Å—Ç–∏ <span class="dropdown-arrow">‚ñº</span>
            </button>
            <div class="dropdown-menu" id="applianceDropdown">
                <a href="#" class="dropdown-item" data-appliance="all">üîç –í—Å–µ –∑–∞–ø—á–∞—Å—Ç–∏</a>
                <a href="#" class="dropdown-item" data-appliance="refrigerator">üßä –•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∏</a>
                <a href="#" class="dropdown-item" data-appliance="dishwasher">üçΩÔ∏è –ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω—ã–µ –º–∞—à–∏–Ω—ã</a>
                <a href="#" class="dropdown-item" data-appliance="airconditioner">‚ùÑÔ∏è –ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä—ã</a>
                <a href="#" class="dropdown-item" data-appliance="oven">üî• –î—É—Ö–æ–≤—ã–µ —à–∫–∞—Ñ—ã</a>
                <a href="#" class="dropdown-item" data-appliance="washingmachine">üåÄ –°—Ç–∏—Ä–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã</a>
                <a href="#" class="dropdown-item" data-appliance="cooktop">üî• –í–∞—Ä–æ—á–Ω—ã–µ –ø–∞–Ω–µ–ª–∏</a>
                <a href="#" class="dropdown-item" data-appliance="coffeemachine">‚òï –ö–æ—Ñ–µ–º–∞—à–∏–Ω—ã</a>
                <a href="#" class="dropdown-item" data-appliance="tv">üì∫ –¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã</a>
                <a href="#" class="dropdown-item" data-appliance="other">üì¶ –ü—Ä–æ—á–µ–µ</a>
            </div>
        </div>
        <button class="category-btn" data-category="new">–ù–æ–≤—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏</button>
        <button class="category-btn" data-category="used">–ë–£ –∑–∞–ø—á–∞—Å—Ç–∏</button>
        <button class="category-btn" data-category="equipment">–ë–£ —Ç–µ—Ö–Ω–∏–∫–∞</button>
    </nav>

    <main>
        <div id="partsGrid" class="parts-grid">
            <!-- –ó–∞–ø—á–∞—Å—Ç–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
        </div>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø—á–∞—Å—Ç–∏ -->
    <div id="addPartModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—á–∞—Å—Ç—å</h2>
            <form id="addPartForm">
                <div class="form-group">
                    <label for="partName">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–ø—á–∞—Å—Ç–∏:</label>
                    <input type="text" id="partName" required>
                </div>
                
                <div class="form-group">
                    <label for="partCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                    <select id="partCategory" required>
                        <option value="new">–ù–æ–≤—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏</option>
                        <option value="used">–ë–£ –∑–∞–ø—á–∞—Å—Ç–∏</option>
                        <option value="equipment">–ë–£ —Ç–µ—Ö–Ω–∏–∫–∞</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="partAppliance">–¢–∏–ø —Ç–µ—Ö–Ω–∏–∫–∏:</label>
                    <select id="partAppliance">
                        <option value="">–ù–µ —É–∫–∞–∑–∞–Ω–æ</option>
                        <option value="refrigerator">üßä –•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∏</option>
                        <option value="dishwasher">üçΩÔ∏è –ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω—ã–µ –º–∞—à–∏–Ω—ã</option>
                        <option value="airconditioner">‚ùÑÔ∏è –ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä—ã</option>
                        <option value="oven">üî• –î—É—Ö–æ–≤—ã–µ —à–∫–∞—Ñ—ã</option>
                        <option value="washingmachine">üåÄ –°—Ç–∏—Ä–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã</option>
                        <option value="cooktop">üî• –í–∞—Ä–æ—á–Ω—ã–µ –ø–∞–Ω–µ–ª–∏</option>
                        <option value="coffeemachine">‚òï –ö–æ—Ñ–µ–º–∞—à–∏–Ω—ã</option>
                        <option value="tv">üì∫ –¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã</option>
                        <option value="other">üì¶ –ü—Ä–æ—á–µ–µ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="partPrice">–¶–µ–Ω–∞ (–±–µ–ª. —Ä—É–±.):</label>
                    <input type="number" id="partPrice" min="0" required>
                </div>
                
                <div class="form-group" id="quantityGroup" style="display: none;">
                    <label for="partQuantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç.):</label>
                    <input type="number" id="partQuantity" min="1" value="1">
                </div>
                
                <div class="form-group">
                    <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</label>
                    <div class="contact-type-selector">
                        <label>
                            <input type="radio" name="contactType" value="phone" checked>
                            –¢–µ–ª–µ—Ñ–æ–Ω
                        </label>
                        <label>
                            <input type="radio" name="contactType" value="email">
                            Email
                        </label>
                        <label>
                            <input type="radio" name="contactType" value="telegram">
                            Telegram
                        </label>
                    </div>
                    <input type="tel" id="partPhone" placeholder="+375 (XX) XXX-XX-XX" required>
                    <input type="email" id="partEmail" placeholder="email@example.com" style="display: none;">
                    <input type="text" id="partTelegram" placeholder="@username" style="display: none;">
                </div>
                
                <div class="form-group">
                    <label for="partDescription">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="partDescription" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="partImages">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏:</label>
                    <div class="image-upload-container">
                        <div class="file-input-section">
                            <input type="file" id="partImages" accept="image/*" multiple>
                            <button type="button" id="cameraBtn" class="camera-btn">üì∑ –ö–∞–º–µ—Ä–∞</button>
                        </div>
                        <div id="imagePreview" class="image-preview"></div>
                    </div>
                </div>
                
                <button type="submit" class="submit-btn">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—á–∞—Å—Ç—å</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="authForms">
                <div id="loginForm" class="auth-form">
                    <h2>–í—Ö–æ–¥</h2>
                    <form id="loginFormElement">
                        <div class="form-group">
                            <label for="loginEmail">Email:</label>
                            <input type="email" id="loginEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">–ü–∞—Ä–æ–ª—å:</label>
                            <input type="password" id="loginPassword" required>
                        </div>
                        <button type="submit" class="submit-btn">–í–æ–π—Ç–∏</button>
                    </form>
                    <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" id="showRegister">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
                </div>
                
                <div id="registerForm" class="auth-form" style="display: none;">
                    <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                    <form id="registerFormElement">
                        <div class="form-group">
                            <label for="registerName">–ò–º—è:</label>
                            <input type="text" id="registerName" required>
                        </div>
                        <div class="form-group">
                            <label for="registerEmail">Email:</label>
                            <input type="email" id="registerEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="registerPassword">–ü–∞—Ä–æ–ª—å:</label>
                            <input type="password" id="registerPassword" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label for="registerPhone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                            <input type="tel" id="registerPhone" placeholder="+7 (XXX) XXX-XX-XX">
                        </div>
                        <button type="submit" class="submit-btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                    </form>
                    <p>–ï—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" id="showLogin">–í–æ–π—Ç–∏</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ -->
    <div id="profileModal" class="modal">
        <div class="modal-content profile-modal">
            <span class="close">&times;</span>
            <h2>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
            
            <div class="profile-tabs">
                <button class="tab-btn active" data-tab="info">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
                <button class="tab-btn" data-tab="parts">–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</button>
                <button class="tab-btn" data-tab="password">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
            </div>

            <div class="tab-content">
                <div id="infoTab" class="tab-pane active">
                    <div class="profile-info">
                        <div class="info-item">
                            <label>–ò–º—è:</label>
                            <span id="profileName"></span>
                        </div>
                        <div class="info-item">
                            <label>Email:</label>
                            <span id="profileEmail"></span>
                        </div>
                        <div class="info-item">
                            <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                            <span id="profilePhone"></span>
                        </div>
                        <div class="info-item">
                            <label>–†–æ–ª—å:</label>
                            <span id="profileRole"></span>
                        </div>
                        <div class="info-item">
                            <label>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</label>
                            <span id="profileDate"></span>
                        </div>
                        <div class="profile-actions">
                            <button id="editProfileBtn" class="submit-btn" style="margin-top: 15px;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</button>
                        </div>
                    </div>
                </div>

                <div id="partsTab" class="tab-pane">
                    <div id="userPartsList" class="user-parts-list">
                        <!-- –û–±—ä—è–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                    </div>
                </div>

                <div id="passwordTab" class="tab-pane">
                    <form id="changePasswordForm">
                        <div class="form-group">
                            <label for="currentPassword">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å:</label>
                            <input type="password" id="currentPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="newPassword">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
                            <input type="password" id="newPassword" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
                            <input type="password" id="confirmPassword" required minlength="6">
                        </div>
                        <button type="submit" class="submit-btn">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
    <div id="editProfileModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h2>
            <form id="editProfileForm">
                <div class="form-group">
                    <label for="editName">–ò–º—è:</label>
                    <input type="text" id="editName" required>
                </div>
                <div class="form-group">
                    <label for="editEmail">Email:</label>
                    <input type="email" id="editEmail" required>
                </div>
                <div class="form-group">
                    <label for="editPhone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                    <input type="tel" id="editPhone" placeholder="+375 (XX) XXX-XX-XX">
                </div>
                <button type="submit" class="submit-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </form>
        </div>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
        async function syncData() {
            try {
                const syncBtn = document.getElementById('syncBtn');
                syncBtn.disabled = true;
                syncBtn.textContent = '‚è≥ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...';
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω GitHub –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                let token = localStorage.getItem('githubToken');
                if (!token) {
                    const newToken = prompt('–î–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω—É–∂–µ–Ω GitHub —Ç–æ–∫–µ–Ω (repo). –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞:');
                    if (newToken) {
                        localStorage.setItem('githubToken', newToken);
                        token = newToken;
                    } else {
                        return;
                    }
                }
                
                // –°–û–•–†–ê–ù–Ø–ï–ú –í–°–ï –°–ï–°–°–ò–ò –í –ü–ï–†–ï–ú–ï–ù–ù–´–ï
                const currentSession = localStorage.getItem('currentSession');
                const currentUser = localStorage.getItem('currentUser');
                const users = localStorage.getItem('users');
                const partsCatalogUsers = localStorage.getItem('partsCatalogUsers');
                
                console.log('Before sync - Session:', currentSession);
                console.log('Before sync - User:', currentUser);
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ —Å GitHub
                const response = await fetch('https://raw.githubusercontent.com/urbonchik1888-cell/zapchasti-v2/main/data.json?t=' + Date.now());
                if (response.ok) {
                    const data = await response.json();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ, –Ω–µ —Ç—Ä–æ–≥–∞—è —Å–µ—Å—Å–∏–∏
                    if (data.newParts) localStorage.setItem('newParts', JSON.stringify(data.newParts));
                    if (data.usedParts) localStorage.setItem('usedParts', JSON.stringify(data.usedParts));
                    if (data.appliances) localStorage.setItem('appliances', JSON.stringify(data.appliances));
                    if (data.users) localStorage.setItem('users', JSON.stringify(data.users));
                    
                    // –ù–ï–ú–ï–î–õ–ï–ù–ù–û –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –í–°–ï —Å–µ—Å—Å–∏–∏
                    if (currentSession) localStorage.setItem('currentSession', currentSession);
                    if (currentUser) localStorage.setItem('currentUser', currentUser);
                    if (users) localStorage.setItem('users', users);
                    if (partsCatalogUsers) localStorage.setItem('partsCatalogUsers', partsCatalogUsers);
                    if (token) localStorage.setItem('githubToken', token);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–µ—Å—Å–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
                    console.log('After sync - Session:', localStorage.getItem('currentSession'));
                    console.log('After sync - User:', localStorage.getItem('currentUser'));
                    
                    alert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å GitHub!');
                    
                    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    if (typeof catalog !== 'undefined') {
                        catalog.checkAuth();
                        catalog.parts = catalog.loadParts();
                        catalog.renderParts();
                        catalog.updateAuthUI();
                    }
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö —Å GitHub');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö');
            } finally {
                const syncBtn = document.getElementById('syncBtn');
                syncBtn.disabled = false;
                syncBtn.textContent = 'üîÑ';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –ø–æ –∂–µ–ª–∞–Ω–∏—é)
        function clearAllData() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.')) {
                localStorage.clear();
                alert('–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–∞.');
                window.location.reload();
            }
        }
    </script>
    <script src="script.js"></script>
</body>
</html>
